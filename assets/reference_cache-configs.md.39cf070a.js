import{_ as s,c as a,o as n,Q as e}from"./chunks/framework.ddc2bfae.js";const u=JSON.parse('{"title":"Cache Configs","description":"","frontmatter":{},"headers":[],"relativePath":"reference/cache-configs.md","filePath":"reference/cache-configs.md"}'),l={name:"reference/cache-configs.md"},o=e(`<h1 id="cache-configs" tabindex="-1">Cache Configs <a class="header-anchor" href="#cache-configs" aria-label="Permalink to &quot;Cache Configs&quot;">​</a></h1><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Currently, the auto-caching feature is <strong>EXPERIMENTAL</strong>.</p><p>Still, we strongly suggest to use it in some little parts of your application.</p></div><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-p9Mk2" id="tab-2soDPfl" checked="checked"><label for="tab-2soDPfl">app/config.ts</label></div><div class="blocks"><div class="language-ts vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { IApplicationConfig, CacheStrategies } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;axe-api&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">config</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IApplicationConfig</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">  cache: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    enable: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    ttl: </span><span style="color:#79B8FF;">300</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    invalidation: CacheStrategies.TimeBased,</span></span>
<span class="line"><span style="color:#E1E4E8;">    cachePrefix: </span><span style="color:#9ECBFF;">&#39;axe-api&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    tagPrefix: </span><span style="color:#9ECBFF;">&#39;tag&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">cacheKey</span><span style="color:#E1E4E8;">: (</span><span style="color:#FFAB70;">req</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">AxeRequest</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;custom-cache-key&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">    responseHeader: </span><span style="color:#9ECBFF;">&#39;X-Axe-API-Cache&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> config;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { IApplicationConfig, CacheStrategies } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;axe-api&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">config</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IApplicationConfig</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">...</span></span>
<span class="line"><span style="color:#24292E;">  cache: {</span></span>
<span class="line"><span style="color:#24292E;">    enable: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    ttl: </span><span style="color:#005CC5;">300</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    invalidation: CacheStrategies.TimeBased,</span></span>
<span class="line"><span style="color:#24292E;">    cachePrefix: </span><span style="color:#032F62;">&#39;axe-api&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    tagPrefix: </span><span style="color:#032F62;">&#39;tag&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">cacheKey</span><span style="color:#24292E;">: (</span><span style="color:#E36209;">req</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">AxeRequest</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;custom-cache-key&#39;</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    responseHeader: </span><span style="color:#032F62;">&#39;X-Axe-API-Cache&#39;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">...</span></span>
<span class="line"><span style="color:#24292E;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> config;</span></span></code></pre></div></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>All configurations can be overridden by version, model, and handler-based configurations.</p></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>You can override only a specific configuration if you wish in version, model, and handler-based configurations.</p></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>You MUST set <a href="/reference/redis-configs.html">Redis configuration</a>.</p></div><h2 id="enable" tabindex="-1"><code>enable</code> <a class="header-anchor" href="#enable" aria-label="Permalink to &quot;\`enable\`&quot;">​</a></h2><p>You can use this configuration to enable or disable the auto-caching across all endpoints.</p><p>The default value is <code>false</code>.</p><h2 id="ttl" tabindex="-1"><code>ttl</code> <a class="header-anchor" href="#ttl" aria-label="Permalink to &quot;\`ttl\`&quot;">​</a></h2><p>The default invalidation time in seconds.</p><h2 id="invalidation" tabindex="-1"><code>invalidation</code> <a class="header-anchor" href="#invalidation" aria-label="Permalink to &quot;\`invalidation\`&quot;">​</a></h2><p>The cache invalidation strategy.</p><p>There are two times cache invalidation strategies that you can use.</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">enum</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">CacheStrategies</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">TimeBased</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">TagBased</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">enum</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">CacheStrategies</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">TimeBased</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">TagBased</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h5 id="cachestrategies-timebased" tabindex="-1"><code>CacheStrategies.TimeBased</code> <a class="header-anchor" href="#cachestrategies-timebased" aria-label="Permalink to &quot;\`CacheStrategies.TimeBased\`&quot;">​</a></h5><p>In this cache invalidation strategy, cache values would be invalid after the <code>ttl</code> time automatically.</p><h5 id="cachestrategies-tagbased" tabindex="-1"><code>CacheStrategies.TagBased</code> <a class="header-anchor" href="#cachestrategies-tagbased" aria-label="Permalink to &quot;\`CacheStrategies.TagBased\`&quot;">​</a></h5><p>In this strategy, the cached value would be invalidated both when after <code>ttl</code> time and the cached record is updated or deleted.</p><h2 id="cacheprefix" tabindex="-1"><code>cachePrefix</code> <a class="header-anchor" href="#cacheprefix" aria-label="Permalink to &quot;\`cachePrefix\`&quot;">​</a></h2><p>The cache prefix that used on all cache keys. You can use your application name.</p><p>The default value is <code>axe-api</code></p><h2 id="tagprefix" tabindex="-1"><code>tagPrefix</code> <a class="header-anchor" href="#tagprefix" aria-label="Permalink to &quot;\`tagPrefix\`&quot;">​</a></h2><p>The tag prefix that used for all tagged items in \`TagBased\`\` invalidation strategies.</p><p>The default value is <code>tag</code>.</p><p>Example key generation:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">cacheKey</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`\${</span><span style="color:#E1E4E8;">cachePrefix</span><span style="color:#9ECBFF;">}:\${</span><span style="color:#E1E4E8;">tagPrefix</span><span style="color:#9ECBFF;">}:\${</span><span style="color:#E1E4E8;">cacheKey</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">cacheKey</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`\${</span><span style="color:#24292E;">cachePrefix</span><span style="color:#032F62;">}:\${</span><span style="color:#24292E;">tagPrefix</span><span style="color:#032F62;">}:\${</span><span style="color:#24292E;">cacheKey</span><span style="color:#032F62;">}\`</span><span style="color:#24292E;">;</span></span></code></pre></div><h2 id="cachekey" tabindex="-1"><code>cacheKey</code> <a class="header-anchor" href="#cachekey" aria-label="Permalink to &quot;\`cacheKey\`&quot;">​</a></h2><p>The Axe API uses the following function to generate cache keys automatically.</p><p>You can override it and generate your custom key.</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">generateCacheKeu</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">req</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">AxeRequest</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">stringify</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    url: req.url,</span></span>
<span class="line"><span style="color:#E1E4E8;">    method: req.method,</span></span>
<span class="line"><span style="color:#E1E4E8;">    headers: {</span></span>
<span class="line"><span style="color:#E1E4E8;">      Accept: req.</span><span style="color:#B392F0;">header</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Accept&quot;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;Accept-Encoding&quot;</span><span style="color:#E1E4E8;">: req.</span><span style="color:#B392F0;">header</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Accept-Encoding&quot;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;Accept-Language&quot;</span><span style="color:#E1E4E8;">: req.</span><span style="color:#B392F0;">header</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Accept-Language&quot;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">      Authorization: req.</span><span style="color:#B392F0;">header</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Authorization&quot;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">      Host: req.</span><span style="color:#B392F0;">header</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Host&quot;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">      Origin: req.</span><span style="color:#B392F0;">header</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Origin&quot;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">      Referer: req.</span><span style="color:#B392F0;">header</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Referer&quot;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;User-Agent&quot;</span><span style="color:#E1E4E8;">: req.</span><span style="color:#B392F0;">header</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;User-Agent&quot;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">generateCacheKeu</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">req</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">AxeRequest</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">JSON</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">stringify</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">    url: req.url,</span></span>
<span class="line"><span style="color:#24292E;">    method: req.method,</span></span>
<span class="line"><span style="color:#24292E;">    headers: {</span></span>
<span class="line"><span style="color:#24292E;">      Accept: req.</span><span style="color:#6F42C1;">header</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Accept&quot;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;Accept-Encoding&quot;</span><span style="color:#24292E;">: req.</span><span style="color:#6F42C1;">header</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Accept-Encoding&quot;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;Accept-Language&quot;</span><span style="color:#24292E;">: req.</span><span style="color:#6F42C1;">header</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Accept-Language&quot;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">      Authorization: req.</span><span style="color:#6F42C1;">header</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Authorization&quot;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">      Host: req.</span><span style="color:#6F42C1;">header</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Host&quot;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">      Origin: req.</span><span style="color:#6F42C1;">header</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Origin&quot;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">      Referer: req.</span><span style="color:#6F42C1;">header</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Referer&quot;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;User-Agent&quot;</span><span style="color:#24292E;">: req.</span><span style="color:#6F42C1;">header</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;User-Agent&quot;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">};</span></span></code></pre></div><h2 id="responseheader" tabindex="-1"><code>responseHeader</code> <a class="header-anchor" href="#responseheader" aria-label="Permalink to &quot;\`responseHeader\`&quot;">​</a></h2><p>Axe API exposes the cache information in HTTP Response headers if it is Missed or Hit.</p><p>The default value is: <code>X-Axe-API-Cache</code></p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>You should set as <strong>NULL</strong> if you want to hide that information.</p></div>`,35),p=[o];function t(c,r,i,E,y,d){return n(),a("div",null,p)}const g=s(l,[["render",t]]);export{u as __pageData,g as default};

import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.18efe07a.js";const u=JSON.parse('{"title":"File uploading","description":"","frontmatter":{},"headers":[],"relativePath":"learn/file-uploading.md","filePath":"learn/file-uploading.md"}'),o={name:"learn/file-uploading.md"},e=l(`<h1 id="file-uploading" tabindex="-1">File uploading <a class="header-anchor" href="#file-uploading" aria-label="Permalink to &quot;File uploading&quot;">​</a></h1><p class="description"> Axe API provides file-uploading helpers. We are going to explain here how it is easy to add file uploading support to your API. </p><ul class="intro"><li>You will learn</li><li>How to upload files?</li><li>How to handle files?</li><li>How to send a file upload request to the server?</li></ul><h2 id="getting-started" tabindex="-1">Getting started <a class="header-anchor" href="#getting-started" aria-label="Permalink to &quot;Getting started&quot;">​</a></h2><p>File uploading is an important part of APIs. You can use many different techniques and methods. We are going to explain how you can add the <a href="https://www.npmjs.com/package/formidable" target="_blank" rel="noreferrer">formidable</a> library to your API.</p><h2 id="installing-dependencies" tabindex="-1">Installing dependencies <a class="header-anchor" href="#installing-dependencies" aria-label="Permalink to &quot;Installing dependencies&quot;">​</a></h2><p>First of all, let&#39;s install the dependencies. We are going to use the <a href="https://www.npmjs.com/package/formidable" target="_blank" rel="noreferrer">formidable</a> library.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">npm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--save</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">formidable</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">npm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--save</span><span style="color:#24292E;"> </span><span style="color:#032F62;">formidable</span></span></code></pre></div><h2 id="handling-files" tabindex="-1">Handling files <a class="header-anchor" href="#handling-files" aria-label="Permalink to &quot;Handling files&quot;">​</a></h2><p>In Axe API, you are ready to handle files whenever you want. Let&#39;s assume that we have a <code>User</code> model and we are going to upload files in the creating new user.</p><p>We should create the following hook file;</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-EaMgZ" id="tab-EKHBMbS" checked="checked"><label for="tab-EKHBMbS">app/v1/Hooks/User/onBeforeInsert.ts</label></div><div class="blocks"><div class="language-ts vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { IContext, ApiError } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;axe-api&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> ({ </span><span style="color:#FFAB70;">formData</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">req</span><span style="color:#E1E4E8;"> }</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IContext</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">fields</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">files</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> req.</span><span style="color:#B392F0;">files</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (files.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ApiError</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;The file parameter is required!&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// TODO: upload file in anywhere like AWS S3, etc.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// set the path to the original formData</span></span>
<span class="line"><span style="color:#E1E4E8;">  formData.path_name </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;s3://filename.jpg&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { IContext, ApiError } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;axe-api&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> ({ </span><span style="color:#E36209;">formData</span><span style="color:#24292E;">, </span><span style="color:#E36209;">req</span><span style="color:#24292E;"> }</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IContext</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">fields</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">files</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> req.</span><span style="color:#6F42C1;">files</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (files.</span><span style="color:#005CC5;">length</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ApiError</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;The file parameter is required!&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// TODO: upload file in anywhere like AWS S3, etc.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// set the path to the original formData</span></span>
<span class="line"><span style="color:#24292E;">  formData.path_name </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;s3://filename.jpg&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">};</span></span></code></pre></div></div></div><p>You can upload the file wherever you want. Also, you can set the user&#39;s model data to be saved for the file location.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>The <code>req.files()</code> method calls the <code>parse()</code> function of <code>formidable</code> library. You can get more information from the <a href="https://github.com/node-formidable/formidable#with-nodejs-http-module" target="_blank" rel="noreferrer">library documentation here</a>.</p></div><h2 id="sending-request" tabindex="-1">Sending request <a class="header-anchor" href="#sending-request" aria-label="Permalink to &quot;Sending request&quot;">​</a></h2><p>The only change is the request type.</p><p>You should send the file to the Axe API server like the following example;</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--location</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;localhost:3000/api/v1/users&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--form</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;file=@&quot;/Users/my-user/Download/axe-api.png&quot;&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--form</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;name=&quot;John&quot;&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--form</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;surname=&quot;Locke&quot;&#39;</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--location</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;localhost:3000/api/v1/users&#39;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line highlighted"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--form</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;file=@&quot;/Users/my-user/Download/axe-api.png&quot;&#39;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--form</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;name=&quot;John&quot;&#39;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--form</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;surname=&quot;Locke&quot;&#39;</span></span></code></pre></div><h2 id="next-steps" tabindex="-1">Next steps <a class="header-anchor" href="#next-steps" aria-label="Permalink to &quot;Next steps&quot;">​</a></h2><p>In this section, we simply demonstrate a file-uploading example.</p><p>In the next section, we are going to discuss about Authentication.</p>`,21),p=[e];function t(r,c,i,y,E,d){return a(),n("div",null,p)}const f=s(o,[["render",t]]);export{u as __pageData,f as default};

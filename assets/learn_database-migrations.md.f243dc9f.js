import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.b8d6d8db.js";const h=JSON.parse('{"title":"Migrate database","description":"","frontmatter":{},"headers":[],"relativePath":"learn/database-migrations.md","filePath":"learn/database-migrations.md"}'),p={name:"learn/database-migrations.md"},o=l(`<h1 id="migrate-database" tabindex="-1">Migrate database <a class="header-anchor" href="#migrate-database" aria-label="Permalink to &quot;Migrate database&quot;">​</a></h1><p class="description"> Axe API doesn&#39;t provide a database migration tool internally. But it uses Knex.js which provides a migration tool. In this section, we are going to talk about the basic of the database migration tool. </p><ul class="intro"><li>You will learn</li><li>What is Knex.js?</li><li>How to use Knex CLI?</li><li>How to create a database migration file?</li><li>How to execute migrations?</li></ul><p>Axe API uses <a href="http://knexjs.org/" target="_blank" rel="noreferrer">Knex.js</a> as the <strong>query builder</strong>. But also, it uses <a href="https://knexjs.org/guide/schema-builder.html" target="_blank" rel="noreferrer">The Schema Builder of Knex.js</a>. You may find more things in the original documentation about the migration than here. But we want to describe some fundamentals about the migration structure.</p><p>First of all, we are using the <code>./migrations</code> directory to keep the migration files. Also, we are using the power of <a href="http://knexjs.org/" target="_blank" rel="noreferrer">Knex.js</a> for migrations.</p><h2 id="installation" tabindex="-1">Installation <a class="header-anchor" href="#installation" aria-label="Permalink to &quot;Installation&quot;">​</a></h2><p>To execute the migrations, you need to install the <strong>Knex CLI</strong> in your development environment;</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">npm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-g</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">knex</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">npm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-g</span><span style="color:#24292E;"> </span><span style="color:#032F62;">knex</span></span></code></pre></div><p>To test <strong>knex CLI</strong> is accessible, you can use the following command;</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">knex</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--version</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Knex</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CLI</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.95</span><span style="color:#9ECBFF;">.5</span></span>
<span class="line"><span style="color:#B392F0;">Knex</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Local</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.95</span><span style="color:#9ECBFF;">.5</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">knex</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--version</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Knex</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CLI</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.95</span><span style="color:#032F62;">.5</span></span>
<span class="line"><span style="color:#6F42C1;">Knex</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Local</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.95</span><span style="color:#032F62;">.5</span></span></code></pre></div><h2 id="using-cli" tabindex="-1">Using CLI <a class="header-anchor" href="#using-cli" aria-label="Permalink to &quot;Using CLI&quot;">​</a></h2><p>The CLI provides multiple commands to use. On the other hand, <a href="http://knexjs.org/" target="_blank" rel="noreferrer">Knex.js</a> uses <a href="https://nodejs.org/api/modules.html#modules_modules_commonjs_modules" target="_blank" rel="noreferrer">CommonJS</a> as the module system. But we are using <a href="https://nodejs.org/api/esm.html#esm_modules_ecmascript_modules" target="_blank" rel="noreferrer">ECMAScript modules</a>. That&#39;s why we should use the <code>--esm</code> option to execute the migration files.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">knex</span></span>
<span class="line"><span style="color:#B392F0;">Usage:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cli</span><span style="color:#E1E4E8;"> [options] [command]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Options:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-V,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--version</span><span style="color:#E1E4E8;">                   </span><span style="color:#9ECBFF;">output</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">number</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">--debug</span><span style="color:#E1E4E8;">                         </span><span style="color:#9ECBFF;">Run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">debugging.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">--knexfile</span><span style="color:#E1E4E8;"> [path]               Specify the knexfile path.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">--knexpath</span><span style="color:#E1E4E8;"> [path]               Specify the path to knex instance.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">--cwd</span><span style="color:#E1E4E8;"> [path]                    Specify the working directory.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">--client</span><span style="color:#E1E4E8;"> [name]                 Set DB client without a knexfile.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">--connection</span><span style="color:#E1E4E8;"> [address]          Set DB connection without a knexfile.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">--migrations-directory</span><span style="color:#E1E4E8;"> [path]   Set migrations directory without a knexfile.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">--migrations-table-name</span><span style="color:#E1E4E8;"> [path]  Set migrations table name without a knexfile.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">--env</span><span style="color:#E1E4E8;"> [name]                    environment, default: p<wbr>rocess.env.NODE_ENV </span><span style="color:#F97583;">||</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#B392F0;">development</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">--esm</span><span style="color:#E1E4E8;">                           </span><span style="color:#9ECBFF;">Enable</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ESM</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">interop.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">--specific</span><span style="color:#E1E4E8;"> [path]               Specify one seed file to execute.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">--timestamp-filename-prefix</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Enable</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">timestamp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">prefix</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#B392F0;">generated</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">seed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">files.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-h,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--help</span><span style="color:#E1E4E8;">                      </span><span style="color:#9ECBFF;">display</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">help</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">command</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Commands:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">init</span><span style="color:#E1E4E8;"> [options]                          Create a fresh knexfile.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">migrate:make</span><span style="color:#E1E4E8;"> [options] </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">name</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           Create a named migration file.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">migrate:latest</span><span style="color:#E1E4E8;"> [options]                Run all migrations that have not yet</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#B392F0;">been</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">migrate:up</span><span style="color:#E1E4E8;"> [&lt;name&gt;]                     Run the next or the specified</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#B392F0;">migration</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">that</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">has</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">yet</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">been</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">migrate:rollback</span><span style="color:#E1E4E8;"> [options]              Rollback the last batch of migrations</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#B392F0;">performed.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">migrate:down</span><span style="color:#E1E4E8;"> [&lt;name&gt;]                   Undo the last or the specified</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#B392F0;">migration</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">that</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">was</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">already</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">migrate:currentVersion</span><span style="color:#E1E4E8;">                  </span><span style="color:#9ECBFF;">View</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">current</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#B392F0;">migration.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">migrate:list</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">migrate:status</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">List</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">migrations</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">files</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#B392F0;">status.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">migrate:unlock</span><span style="color:#E1E4E8;">                          </span><span style="color:#9ECBFF;">Forcibly</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">unlocks</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">migrations</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#B392F0;">table.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">seed:make</span><span style="color:#E1E4E8;"> [options] </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">name</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">              Create a named seed file.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">seed:run</span><span style="color:#E1E4E8;"> [options]                      Run seed files.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">help</span><span style="color:#E1E4E8;"> [command]                  display help </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> command</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">knex</span></span>
<span class="line"><span style="color:#6F42C1;">Usage:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cli</span><span style="color:#24292E;"> [options] [command]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Options:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-V,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--version</span><span style="color:#24292E;">                   </span><span style="color:#032F62;">output</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span><span style="color:#24292E;"> </span><span style="color:#032F62;">number</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">--debug</span><span style="color:#24292E;">                         </span><span style="color:#032F62;">Run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#032F62;">debugging.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">--knexfile</span><span style="color:#24292E;"> [path]               Specify the knexfile path.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">--knexpath</span><span style="color:#24292E;"> [path]               Specify the path to knex instance.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">--cwd</span><span style="color:#24292E;"> [path]                    Specify the working directory.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">--client</span><span style="color:#24292E;"> [name]                 Set DB client without a knexfile.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">--connection</span><span style="color:#24292E;"> [address]          Set DB connection without a knexfile.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">--migrations-directory</span><span style="color:#24292E;"> [path]   Set migrations directory without a knexfile.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">--migrations-table-name</span><span style="color:#24292E;"> [path]  Set migrations table name without a knexfile.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">--env</span><span style="color:#24292E;"> [name]                    environment, default: p<wbr>rocess.env.NODE_ENV </span><span style="color:#D73A49;">||</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#6F42C1;">development</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">--esm</span><span style="color:#24292E;">                           </span><span style="color:#032F62;">Enable</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ESM</span><span style="color:#24292E;"> </span><span style="color:#032F62;">interop.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">--specific</span><span style="color:#24292E;"> [path]               Specify one seed file to execute.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">--timestamp-filename-prefix</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Enable</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">timestamp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">prefix</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#6F42C1;">generated</span><span style="color:#24292E;"> </span><span style="color:#032F62;">seed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">files.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-h,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--help</span><span style="color:#24292E;">                      </span><span style="color:#032F62;">display</span><span style="color:#24292E;"> </span><span style="color:#032F62;">help</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">command</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Commands:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">init</span><span style="color:#24292E;"> [options]                          Create a fresh knexfile.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">migrate:make</span><span style="color:#24292E;"> [options] </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">name</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           Create a named migration file.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">migrate:latest</span><span style="color:#24292E;"> [options]                Run all migrations that have not yet</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#6F42C1;">been</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">migrate:up</span><span style="color:#24292E;"> [&lt;name&gt;]                     Run the next or the specified</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#6F42C1;">migration</span><span style="color:#24292E;"> </span><span style="color:#032F62;">that</span><span style="color:#24292E;"> </span><span style="color:#032F62;">has</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">yet</span><span style="color:#24292E;"> </span><span style="color:#032F62;">been</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">migrate:rollback</span><span style="color:#24292E;"> [options]              Rollback the last batch of migrations</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#6F42C1;">performed.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">migrate:down</span><span style="color:#24292E;"> [&lt;name&gt;]                   Undo the last or the specified</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#6F42C1;">migration</span><span style="color:#24292E;"> </span><span style="color:#032F62;">that</span><span style="color:#24292E;"> </span><span style="color:#032F62;">was</span><span style="color:#24292E;"> </span><span style="color:#032F62;">already</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">migrate:currentVersion</span><span style="color:#24292E;">                  </span><span style="color:#032F62;">View</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">current</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#6F42C1;">migration.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">migrate:list</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">migrate:status</span><span style="color:#24292E;">             </span><span style="color:#032F62;">List</span><span style="color:#24292E;"> </span><span style="color:#032F62;">all</span><span style="color:#24292E;"> </span><span style="color:#032F62;">migrations</span><span style="color:#24292E;"> </span><span style="color:#032F62;">files</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#6F42C1;">status.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">migrate:unlock</span><span style="color:#24292E;">                          </span><span style="color:#032F62;">Forcibly</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unlocks</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">migrations</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#6F42C1;">table.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">seed:make</span><span style="color:#24292E;"> [options] </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">name</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">              Create a named seed file.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">seed:run</span><span style="color:#24292E;"> [options]                      Run seed files.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">help</span><span style="color:#24292E;"> [command]                  display help </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> command</span></span></code></pre></div><h2 id="create-migration-file" tabindex="-1">Create migration file <a class="header-anchor" href="#create-migration-file" aria-label="Permalink to &quot;Create migration file&quot;">​</a></h2><p>To create a new migration file in it, you should use the following command;</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">knex</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--esm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">migrate:make</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">User</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Using</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">environment:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">development</span></span>
<span class="line"><span style="color:#B392F0;">Created</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Migration:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">./migrations/20210515162821_User.js</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">knex</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--esm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">migrate:make</span><span style="color:#24292E;"> </span><span style="color:#032F62;">User</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Using</span><span style="color:#24292E;"> </span><span style="color:#032F62;">environment:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">development</span></span>
<span class="line"><span style="color:#6F42C1;">Created</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Migration:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">./migrations/20210515162821_User.js</span></span></code></pre></div><p>If you look the detail of the file (<code>migrations/20210515162821_User.js</code>), you will see the following code;</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">up</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">knex</span><span style="color:#E1E4E8;">) {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">down</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">knex</span><span style="color:#E1E4E8;">) {};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">exports</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">up</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">knex</span><span style="color:#24292E;">) {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">exports</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">down</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">knex</span><span style="color:#24292E;">) {};</span></span></code></pre></div><p>Unfortunately, the CLI created the migration file for CommonJS. We should change it with ESM manually.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">up</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">knex</span><span style="color:#E1E4E8;">) {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">down</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">knex</span><span style="color:#E1E4E8;">) {};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">up</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">knex</span><span style="color:#24292E;">) {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">down</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">knex</span><span style="color:#24292E;">) {};</span></span></code></pre></div><p>And this is the basic structure of our migration files.</p><h2 id="upgrading" tabindex="-1">Upgrading <a class="header-anchor" href="#upgrading" aria-label="Permalink to &quot;Upgrading&quot;">​</a></h2><p>Let&#39;s assume that you&#39;ve written a migration like this;</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">up</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">knex</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> knex.schema.</span><span style="color:#B392F0;">createTable</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;users&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">table</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    table.</span><span style="color:#B392F0;">increments</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    table.</span><span style="color:#B392F0;">string</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;name&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    table.</span><span style="color:#B392F0;">string</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;email&quot;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">unique</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    table.</span><span style="color:#B392F0;">timestamps</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">down</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">knex</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> knex.schema.</span><span style="color:#B392F0;">dropTable</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;users&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">up</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">knex</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> knex.schema.</span><span style="color:#6F42C1;">createTable</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;users&quot;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">table</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    table.</span><span style="color:#6F42C1;">increments</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    table.</span><span style="color:#6F42C1;">string</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;name&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    table.</span><span style="color:#6F42C1;">string</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;email&quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">unique</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    table.</span><span style="color:#6F42C1;">timestamps</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">down</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">knex</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> knex.schema.</span><span style="color:#6F42C1;">dropTable</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;users&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">};</span></span></code></pre></div><p>To execute this migration file, you should execute the following command;</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">knex</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--esm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">migrate:latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Using</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">environment:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">development</span></span>
<span class="line"><span style="color:#B392F0;">Batch</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ran</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">following</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">migrations:</span></span>
<span class="line"><span style="color:#B392F0;">20210515162821_User.js</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">knex</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--esm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">migrate:latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Using</span><span style="color:#24292E;"> </span><span style="color:#032F62;">environment:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">development</span></span>
<span class="line"><span style="color:#6F42C1;">Batch</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ran</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">following</span><span style="color:#24292E;"> </span><span style="color:#032F62;">migrations:</span></span>
<span class="line"><span style="color:#6F42C1;">20210515162821_User.js</span></span></code></pre></div><p>Yay! You created the first database table.</p><h2 id="next-steps" tabindex="-1">Next steps <a class="header-anchor" href="#next-steps" aria-label="Permalink to &quot;Next steps&quot;">​</a></h2><p>In this section, we just clarified the fundamentals of database migration.</p><p>In this next section, we are going to talk about file uploads.</p>`,30),e=[o];function t(r,c,E,y,i,F){return n(),a("div",null,e)}const m=s(p,[["render",t]]);export{h as __pageData,m as default};
